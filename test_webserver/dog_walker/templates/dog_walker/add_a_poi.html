{% extends "dog_walker/base.html" %}
{% load static %}
{% load leaflet_tags %}
{% block role %}
    Current Role: Dog Owner
{% endblock %}
{% block navbar %}
<li class="nav-item">
    <a class="nav-link" href="{% url 'dog_walker-view_map' %}">View Map</a>
</li>

{% endblock navbar %}


{% block content %}
{% leaflet_js %}
{% leaflet_css %}

<style type="text/css">
        #gis {width: 100%; height: 100%;}



</style>
<script type="text/javascript" src="{% static 'map/leaflet.ajax.js' %}"></script>

<script type="text/javascript">
    function add_points(map, options) {
        var datasets = new L.GeoJSON.AJAX("{% url 'poi_dataset' %}", {
            onEachFeature: function(feature, layer) {
                layer.bindPopup(feature.properties.name);
                layer.setIcon(new L.Icon({iconUrl:"/static/map/" +
                    feature.properties.category +
                    ".png",
                    iconSize:   [18, 18],
                    iconAnchor: [9, 13]}))
            }
        });

        datasets.addTo(map);

        var the_marker = {};

        map.on('click', function(e){
            var latlng = map.mouseEventToLatLng(e.originalEvent);
            document.getElementById("lat").value = latlng.lat
            document.getElementById("lng").value = latlng.lng

            if (the_marker != undefined) {
                map.removeLayer(the_marker);
            };

            the_marker = L.marker([latlng.lat, latlng.lng]).addTo(map);
        });
    };
</script>


<div class="row">
    <div class="col-sm-8">
        {% leaflet_map "gis" callback="window.add_points" %}
    </div>
    <div class="col-sm-4">
        <form class="form" action="." method="post">{% csrf_token %}
            <div class="form-row">
                <div class="form-group col-sm-12">
                    <label for="poi_name">What is the name of your Point of Interest</label>
                    <input type="text" class="form-control" id="poi_name" name="name">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-sm-12">
                    <label for="poi_category">What category is the Point of Interest?</label>
                    <select class="form-control" id="poi_category" name="category">
                        <option value="garbage_can">Garbage Can</option>
                        <option value="poop_bags">Poop Bags</option>
                        <option value="dog_friendly">Dog Friendly Location</option>
                        <option value="outdoor_location">Outdoor Location</option>
                    </select>
                </div>
            </div>
             <div class="form-row">
                <div class="form-group col-sm-12">
                    <label for="poi_description">Provide a description of the Point of Interest</label>
                    <textarea class="form-control" id="poi_description" rows="10" cols="40" name="description"></textarea>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-sm-12">
                    <p>Is this a private Point of Interest?</p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="is_private" id="yes"
                               value="yes">
                        <label class="form-check-label" for="yes">
                            Yes
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="is_private" id="no"
                               value="no" checked>
                        <label class="form-check-label" for="no">
                            No
                        </label>
                    </div>
                </div>
            </div>
            <input type="hidden" id="lat" name="lat" value="0">
            <input type="hidden" id="lng" name="lng" value="0">
            <button type="submit" class="btn btn-primary">Add Point</button>
        </form>
    </div>
</div>


{% endblock content %}